import unittest

from route_engine.graphs import MultiDiGraph
from route_engine.shortest_paths import DijkstraShortestPath


class TestDijkstra(unittest.TestCase):

    def setUp(self):
        graph = MultiDiGraph()

        for src, dst, edge_data in _edges:
            graph.insert_edge(src, dst, edge_key=1)
            graph.edge_data(src, dst, edge_key=1).update(edge_data)

        self.solver = DijkstraShortestPath(graph)

    def test1(self):
        src_node, dst_node = 69, 40
        expected_waypoints = [69, 75, 83, 23, 9, 22, 40]
        expected_distance = 81

        result = self.solver.solve(src_node=src_node)
        self.assertEqual(result.waypoints_to(dst_node=dst_node), expected_waypoints)
        self.assertAlmostEqual(result.distance_to(dst_node=dst_node), expected_distance)

    def test2(self):
        src_node, dst_node = 10, 41
        expected_waypoints = [10, 98, 94, 45, 41]
        expected_distance = 44

        result = self.solver.solve(src_node=src_node)
        self.assertEqual(result.waypoints_to(dst_node=dst_node), expected_waypoints)
        self.assertAlmostEqual(result.distance_to(dst_node=dst_node), expected_distance)

    def test3(self):
        src_node, dst_node = 98, 37
        expected_waypoints = [98, 87, 70, 26, 19, 92, 27, 65, 37]
        expected_distance = 54

        result = self.solver.solve(src_node=src_node)
        self.assertEqual(result.waypoints_to(dst_node=dst_node), expected_waypoints)
        self.assertAlmostEqual(result.distance_to(dst_node=dst_node), expected_distance)

    def test4(self):
        src_node, dst_node = 88, 90
        expected_waypoints = [88, 90]
        expected_distance = 15

        result = self.solver.solve(src_node=src_node)
        self.assertEqual(result.waypoints_to(dst_node=dst_node), expected_waypoints)
        self.assertAlmostEqual(result.distance_to(dst_node=dst_node), expected_distance)

    def test5(self):
        src_node, dst_node = 30, 55
        expected_waypoints = [30, 18, 48, 72, 97, 55]
        expected_distance = 85

        result = self.solver.solve(src_node=src_node)
        self.assertEqual(result.waypoints_to(dst_node=dst_node), expected_waypoints)
        self.assertAlmostEqual(result.distance_to(dst_node=dst_node), expected_distance)

    def test6(self):
        src_node, dst_node = 32, 29
        expected_waypoints = [32, 95, 80, 34, 68, 29]
        expected_distance = 74

        result = self.solver.solve(src_node=src_node)
        self.assertEqual(result.waypoints_to(dst_node=dst_node), expected_waypoints)
        self.assertAlmostEqual(result.distance_to(dst_node=dst_node), expected_distance)

    def test7(self):
        src_node, dst_node = 19, 22
        expected_waypoints = [19, 92, 27, 85, 31, 9, 22]
        expected_distance = 60

        result = self.solver.solve(src_node=src_node)
        self.assertEqual(result.waypoints_to(dst_node=dst_node), expected_waypoints)
        self.assertAlmostEqual(result.distance_to(dst_node=dst_node), expected_distance)

    def test8(self):
        src_node, dst_node = 28, 25
        expected_waypoints = [28, 9, 22, 25]
        expected_distance = 57

        result = self.solver.solve(src_node=src_node)
        self.assertEqual(result.waypoints_to(dst_node=dst_node), expected_waypoints)
        self.assertAlmostEqual(result.distance_to(dst_node=dst_node), expected_distance)

    def test9(self):
        src_node, dst_node = 82, 44
        expected_waypoints = [82, 27, 65, 37, 72, 44]
        expected_distance = 87

        result = self.solver.solve(src_node=src_node)
        self.assertEqual(result.waypoints_to(dst_node=dst_node), expected_waypoints)
        self.assertAlmostEqual(result.distance_to(dst_node=dst_node), expected_distance)

    def test10(self):
        src_node, dst_node = 34, 49
        expected_waypoints = [34, 68, 16, 94, 45, 49]
        expected_distance = 62

        result = self.solver.solve(src_node=src_node)
        self.assertEqual(result.waypoints_to(dst_node=dst_node), expected_waypoints)
        self.assertAlmostEqual(result.distance_to(dst_node=dst_node), expected_distance)


_edges = [
    (0, 3, {'length': 43}),
    (0, 17, {'length': 48}),
    (0, 67, {'length': 29}),
    (0, 83, {'length': 43}),
    (0, 97, {'length': 35}),
    (1, 57, {'length': 21}),
    (1, 82, {'length': 26}),
    (2, 18, {'length': 37}),
    (2, 37, {'length': 4}),
    (2, 57, {'length': 22}),
    (3, 0, {'length': 1}),
    (3, 55, {'length': 28}),
    (3, 86, {'length': 20}),
    (3, 87, {'length': 24}),
    (4, 27, {'length': 34}),
    (4, 53, {'length': 12}),
    (4, 72, {'length': 1}),
    (4, 78, {'length': 32}),
    (4, 79, {'length': 43}),
    (5, 89, {'length': 38}),
    (6, 3, {'length': 18}),
    (6, 4, {'length': 21}),
    (6, 13, {'length': 8}),
    (6, 41, {'length': 46}),
    (6, 44, {'length': 37}),
    (6, 50, {'length': 27}),
    (7, 26, {'length': 2}),
    (7, 57, {'length': 43}),
    (7, 68, {'length': 20}),
    (7, 76, {'length': 18}),
    (7, 86, {'length': 1}),
    (8, 14, {'length': 44}),
    (8, 37, {'length': 24}),
    (8, 40, {'length': 21}),
    (8, 48, {'length': 49}),
    (8, 60, {'length': 9}),
    (8, 73, {'length': 9}),
    (8, 75, {'length': 25}),
    (8, 91, {'length': 16}),
    (9, 1, {'length': 48}),
    (9, 5, {'length': 45}),
    (9, 22, {'length': 10}),
    (9, 30, {'length': 6}),
    (9, 37, {'length': 21}),
    (9, 38, {'length': 38}),
    (9, 50, {'length': 4}),
    (9, 58, {'length': 14}),
    (9, 77, {'length': 4}),
    (9, 84, {'length': 39}),
    (10, 15, {'length': 14}),
    (10, 23, {'length': 31}),
    (10, 34, {'length': 34}),
    (10, 48, {'length': 16}),
    (10, 98, {'length': 8}),
    (11, 4, {'length': 49}),
    (11, 6, {'length': 45}),
    (11, 16, {'length': 18}),
    (11, 26, {'length': 19}),
    (11, 28, {'length': 28}),
    (11, 37, {'length': 16}),
    (11, 57, {'length': 43}),
    (11, 83, {'length': 50}),
    (11, 93, {'length': 20}),
    (12, 41, {'length': 42}),
    (12, 56, {'length': 46}),
    (12, 66, {'length': 25}),
    (12, 76, {'length': 6}),
    (12, 78, {'length': 49}),
    (13, 48, {'length': 26}),
    (13, 55, {'length': 16}),
    (13, 65, {'length': 30}),
    (14, 18, {'length': 21}),
    (14, 31, {'length': 36}),
    (14, 60, {'length': 20}),
    (14, 84, {'length': 18}),
    (14, 90, {'length': 30}),
    (15, 8, {'length': 22}),
    (15, 18, {'length': 38}),
    (15, 79, {'length': 22}),
    (15, 87, {'length': 37}),
    (15, 88, {'length': 45}),
    (15, 91, {'length': 49}),
    (15, 95, {'length': 16}),
    (16, 57, {'length': 31}),
    (16, 94, {'length': 1}),
    (17, 74, {'length': 12}),
    (17, 91, {'length': 22}),
    (18, 30, {'length': 43}),
    (18, 48, {'length': 15}),
    (19, 21, {'length': 33}),
    (19, 30, {'length': 34}),
    (19, 47, {'length': 12}),
    (19, 76, {'length': 24}),
    (19, 85, {'length': 42}),
    (19, 92, {'length': 6}),
    (20, 0, {'length': 37}),
    (20, 12, {'length': 45}),
    (20, 14, {'length': 29}),
    (20, 50, {'length': 8}),
    (20, 74, {'length': 3}),
    (20, 87, {'length': 17}),
    (20, 94, {'length': 26}),
    (21, 19, {'length': 29}),
    (21, 35, {'length': 28}),
    (21, 67, {'length': 2}),
    (21, 91, {'length': 17}),
    (21, 98, {'length': 28}),
    (22, 3, {'length': 47}),
    (22, 18, {'length': 43}),
    (22, 21, {'length': 16}),
    (22, 25, {'length': 7}),
    (22, 40, {'length': 25}),
    (22, 47, {'length': 8}),
    (22, 49, {'length': 38}),
    (23, 9, {'length': 8}),
    (23, 12, {'length': 20}),
    (23, 16, {'length': 33}),
    (23, 33, {'length': 9}),
    (23, 41, {'length': 20}),
    (23, 54, {'length': 3}),
    (23, 56, {'length': 3}),
    (23, 61, {'length': 10}),
    (23, 68, {'length': 44}),
    (23, 97, {'length': 31}),
    (24, 22, {'length': 47}),
    (24, 28, {'length': 41}),
    (24, 39, {'length': 16}),
    (24, 51, {'length': 21}),
    (24, 78, {'length': 46}),
    (24, 82, {'length': 17}),
    (24, 90, {'length': 34}),
    (25, 17, {'length': 49}),
    (25, 46, {'length': 47}),
    (25, 54, {'length': 35}),
    (25, 57, {'length': 49}),
    (25, 67, {'length': 39}),
    (25, 89, {'length': 26}),
    (26, 4, {'length': 1}),
    (26, 7, {'length': 2}),
    (26, 8, {'length': 30}),
    (26, 19, {'length': 10}),
    (26, 85, {'length': 36}),
    (27, 43, {'length': 37}),
    (27, 47, {'length': 48}),
    (27, 65, {'length': 12}),
    (27, 85, {'length': 18}),
    (28, 3, {'length': 50}),
    (28, 9, {'length': 40}),
    (28, 19, {'length': 13}),
    (28, 29, {'length': 28}),
    (28, 30, {'length': 7}),
    (28, 32, {'length': 8}),
    (28, 36, {'length': 5}),
    (28, 55, {'length': 27}),
    (28, 80, {'length': 43}),
    (28, 89, {'length': 33}),
    (28, 92, {'length': 24}),
    (28, 99, {'length': 43}),
    (29, 64, {'length': 8}),
    (29, 89, {'length': 18}),
    (30, 10, {'length': 50}),
    (30, 18, {'length': 33}),
    (30, 98, {'length': 48}),
    (31, 9, {'length': 20}),
    (31, 65, {'length': 11}),
    (31, 98, {'length': 42}),
    (32, 12, {'length': 50}),
    (32, 45, {'length': 13}),
    (32, 64, {'length': 15}),
    (32, 65, {'length': 9}),
    (32, 90, {'length': 47}),
    (32, 95, {'length': 10}),
    (33, 36, {'length': 46}),
    (33, 52, {'length': 23}),
    (33, 72, {'length': 21}),
    (33, 82, {'length': 48}),
    (33, 87, {'length': 17}),
    (34, 68, {'length': 1}),
    (34, 70, {'length': 32}),
    (34, 78, {'length': 49}),
    (35, 12, {'length': 26}),
    (35, 32, {'length': 17}),
    (35, 50, {'length': 17}),
    (36, 32, {'length': 46}),
    (36, 58, {'length': 40}),
    (36, 68, {'length': 41}),
    (36, 71, {'length': 21}),
    (36, 76, {'length': 28}),
    (36, 82, {'length': 30}),
    (37, 17, {'length': 3}),
    (37, 48, {'length': 43}),
    (37, 53, {'length': 19}),
    (37, 54, {'length': 11}),
    (37, 72, {'length': 8}),
    (37, 87, {'length': 32}),
    (38, 36, {'length': 3}),
    (38, 55, {'length': 39}),
    (38, 58, {'length': 44}),
    (38, 65, {'length': 18}),
    (39, 31, {'length': 42}),
    (39, 91, {'length': 15}),
    (39, 94, {'length': 12}),
    (40, 30, {'length': 8}),
    (40, 65, {'length': 34}),
    (40, 89, {'length': 33}),
    (41, 17, {'length': 46}),
    (41, 72, {'length': 42}),
    (41, 82, {'length': 39}),
    (41, 87, {'length': 14}),
    (41, 91, {'length': 2}),
    (41, 95, {'length': 24}),
    (42, 23, {'length': 38}),
    (42, 32, {'length': 31}),
    (42, 50, {'length': 38}),
    (43, 22, {'length': 29}),
    (43, 58, {'length': 3}),
    (43, 67, {'length': 4}),
    (43, 68, {'length': 43}),
    (43, 74, {'length': 5}),
    (43, 77, {'length': 11}),
    (43, 94, {'length': 12}),
    (44, 16, {'length': 30}),
    (44, 21, {'length': 5}),
    (44, 39, {'length': 31}),
    (44, 55, {'length': 13}),
    (44, 70, {'length': 13}),
    (44, 84, {'length': 15}),
    (45, 15, {'length': 27}),
    (45, 41, {'length': 2}),
    (45, 49, {'length': 17}),
    (45, 80, {'length': 17}),
    (45, 82, {'length': 40}),
    (46, 14, {'length': 33}),
    (46, 22, {'length': 49}),
    (46, 33, {'length': 28}),
    (46, 66, {'length': 25}),
    (46, 72, {'length': 5}),
    (46, 85, {'length': 19}),
    (46, 87, {'length': 45}),
    (47, 19, {'length': 43}),
    (48, 7, {'length': 35}),
    (48, 35, {'length': 12}),
    (48, 64, {'length': 39}),
    (48, 68, {'length': 9}),
    (48, 72, {'length': 12}),
    (48, 87, {'length': 33}),
    (49, 4, {'length': 5}),
    (49, 25, {'length': 24}),
    (49, 27, {'length': 11}),
    (49, 82, {'length': 6}),
    (49, 93, {'length': 27}),
    (50, 12, {'length': 20}),
    (50, 30, {'length': 37}),
    (51, 15, {'length': 22}),
    (51, 24, {'length': 19}),
    (51, 29, {'length': 32}),
    (51, 76, {'length': 21}),
    (52, 10, {'length': 28}),
    (52, 12, {'length': 39}),
    (52, 33, {'length': 44}),
    (52, 57, {'length': 22}),
    (52, 63, {'length': 15}),
    (52, 77, {'length': 14}),
    (52, 81, {'length': 17}),
    (52, 90, {'length': 8}),
    (53, 15, {'length': 22}),
    (53, 27, {'length': 35}),
    (53, 31, {'length': 21}),
    (53, 66, {'length': 40}),
    (53, 70, {'length': 26}),
    (53, 74, {'length': 25}),
    (53, 84, {'length': 41}),
    (54, 67, {'length': 43}),
    (55, 17, {'length': 6}),
    (55, 62, {'length': 38}),
    (55, 84, {'length': 47}),
    (55, 92, {'length': 47}),
    (55, 97, {'length': 9}),
    (56, 45, {'length': 46}),
    (56, 76, {'length': 10}),
    (56, 81, {'length': 15}),
    (57, 11, {'length': 26}),
    (57, 42, {'length': 48}),
    (57, 98, {'length': 41}),
    (58, 9, {'length': 16}),
    (58, 11, {'length': 38}),
    (58, 41, {'length': 5}),
    (58, 42, {'length': 38}),
    (58, 54, {'length': 13}),
    (58, 57, {'length': 25}),
    (58, 63, {'length': 8}),
    (59, 30, {'length': 30}),
    (59, 38, {'length': 13}),
    (59, 46, {'length': 2}),
    (59, 53, {'length': 6}),
    (59, 57, {'length': 34}),
    (59, 62, {'length': 1}),
    (59, 70, {'length': 45}),
    (59, 91, {'length': 3}),
    (60, 51, {'length': 36}),
    (60, 69, {'length': 1}),
    (61, 28, {'length': 15}),
    (61, 34, {'length': 4}),
    (61, 54, {'length': 38}),
    (61, 74, {'length': 14}),
    (61, 77, {'length': 20}),
    (61, 82, {'length': 1}),
    (61, 85, {'length': 5}),
    (62, 3, {'length': 44}),
    (62, 22, {'length': 26}),
    (62, 25, {'length': 35}),
    (62, 47, {'length': 15}),
    (62, 59, {'length': 21}),
    (63, 15, {'length': 50}),
    (63, 58, {'length': 34}),
    (63, 85, {'length': 45}),
    (64, 92, {'length': 25}),
    (64, 95, {'length': 41}),
    (65, 31, {'length': 48}),
    (65, 37, {'length': 11}),
    (65, 91, {'length': 17}),
    (66, 12, {'length': 38}),
    (66, 28, {'length': 41}),
    (66, 49, {'length': 48}),
    (67, 4, {'length': 25}),
    (67, 12, {'length': 7}),
    (67, 19, {'length': 49}),
    (67, 44, {'length': 49}),
    (67, 48, {'length': 27}),
    (67, 51, {'length': 8}),
    (67, 85, {'length': 44}),
    (68, 16, {'length': 20}),
    (68, 29, {'length': 23}),
    (68, 32, {'length': 40}),
    (68, 44, {'length': 21}),
    (69, 20, {'length': 46}),
    (69, 75, {'length': 19}),
    (69, 82, {'length': 41}),
    (70, 26, {'length': 3}),
    (70, 51, {'length': 41}),
    (70, 78, {'length': 50}),
    (71, 2, {'length': 47}),
    (71, 4, {'length': 32}),
    (71, 9, {'length': 20}),
    (71, 15, {'length': 25}),
    (71, 20, {'length': 25}),
    (71, 23, {'length': 42}),
    (71, 28, {'length': 22}),
    (71, 40, {'length': 39}),
    (71, 77, {'length': 41}),
    (72, 44, {'length': 19}),
    (72, 45, {'length': 25}),
    (72, 73, {'length': 46}),
    (72, 97, {'length': 23}),
    (73, 26, {'length': 11}),
    (74, 1, {'length': 24}),
    (74, 41, {'length': 2}),
    (74, 70, {'length': 21}),
    (74, 83, {'length': 37}),
    (74, 90, {'length': 31}),
    (75, 2, {'length': 43}),
    (75, 63, {'length': 14}),
    (75, 73, {'length': 37}),
    (75, 83, {'length': 8}),
    (76, 10, {'length': 37}),
    (76, 18, {'length': 30}),
    (76, 20, {'length': 40}),
    (76, 56, {'length': 5}),
    (76, 59, {'length': 32}),
    (76, 73, {'length': 18}),
    (76, 89, {'length': 45}),
    (77, 20, {'length': 9}),
    (77, 38, {'length': 10}),
    (77, 49, {'length': 41}),
    (77, 89, {'length': 21}),
    (78, 11, {'length': 7}),
    (78, 16, {'length': 43}),
    (78, 40, {'length': 16}),
    (78, 69, {'length': 34}),
    (78, 83, {'length': 22}),
    (78, 84, {'length': 15}),
    (78, 91, {'length': 38}),
    (79, 5, {'length': 38}),
    (79, 42, {'length': 42}),
    (79, 64, {'length': 1}),
    (79, 91, {'length': 19}),
    (80, 34, {'length': 20}),
    (80, 59, {'length': 27}),
    (80, 60, {'length': 2}),
    (80, 73, {'length': 25}),
    (81, 38, {'length': 30}),
    (81, 46, {'length': 33}),
    (81, 89, {'length': 35}),
    (81, 95, {'length': 35}),
    (82, 27, {'length': 37}),
    (83, 16, {'length': 26}),
    (83, 23, {'length': 11}),
    (83, 33, {'length': 23}),
    (83, 38, {'length': 8}),
    (83, 54, {'length': 1}),
    (83, 59, {'length': 17}),
    (83, 60, {'length': 8}),
    (84, 5, {'length': 38}),
    (84, 12, {'length': 45}),
    (84, 15, {'length': 29}),
    (84, 45, {'length': 50}),
    (85, 0, {'length': 9}),
    (85, 4, {'length': 22}),
    (85, 31, {'length': 5}),
    (86, 5, {'length': 34}),
    (86, 61, {'length': 17}),
    (86, 80, {'length': 36}),
    (86, 81, {'length': 4}),
    (86, 83, {'length': 35}),
    (86, 84, {'length': 33}),
    (86, 89, {'length': 41}),
    (87, 65, {'length': 40}),
    (87, 70, {'length': 4}),
    (87, 72, {'length': 34}),
    (87, 90, {'length': 5}),
    (88, 7, {'length': 10}),
    (88, 13, {'length': 15}),
    (88, 37, {'length': 27}),
    (88, 45, {'length': 12}),
    (88, 64, {'length': 39}),
    (88, 90, {'length': 15}),
    (88, 96, {'length': 40}),
    (89, 12, {'length': 46}),
    (89, 21, {'length': 30}),
    (89, 22, {'length': 42}),
    (89, 81, {'length': 38}),
    (90, 5, {'length': 10}),
    (90, 15, {'length': 11}),
    (90, 40, {'length': 19}),
    (90, 46, {'length': 40}),
    (90, 83, {'length': 28}),
    (90, 84, {'length': 6}),
    (91, 0, {'length': 16}),
    (91, 13, {'length': 2}),
    (91, 68, {'length': 44}),
    (91, 74, {'length': 26}),
    (91, 75, {'length': 18}),
    (92, 20, {'length': 44}),
    (92, 27, {'length': 1}),
    (92, 34, {'length': 28}),
    (92, 68, {'length': 15}),
    (92, 88, {'length': 17}),
    (92, 89, {'length': 40}),
    (93, 15, {'length': 33}),
    (93, 20, {'length': 49}),
    (93, 36, {'length': 42}),
    (93, 37, {'length': 3}),
    (93, 43, {'length': 44}),
    (93, 55, {'length': 39}),
    (93, 59, {'length': 16}),
    (93, 66, {'length': 23}),
    (93, 81, {'length': 22}),
    (93, 88, {'length': 42}),
    (93, 90, {'length': 41}),
    (94, 22, {'length': 30}),
    (94, 27, {'length': 37}),
    (94, 33, {'length': 31}),
    (94, 45, {'length': 23}),
    (94, 70, {'length': 42}),
    (94, 72, {'length': 44}),
    (94, 96, {'length': 45}),
    (95, 2, {'length': 15}),
    (95, 80, {'length': 20}),
    (95, 85, {'length': 44}),
    (95, 89, {'length': 33}),
    (96, 61, {'length': 38}),
    (96, 76, {'length': 16}),
    (96, 89, {'length': 36}),
    (96, 94, {'length': 31}),
    (97, 11, {'length': 23}),
    (97, 16, {'length': 32}),
    (97, 23, {'length': 11}),
    (97, 28, {'length': 41}),
    (97, 38, {'length': 43}),
    (97, 55, {'length': 2}),
    (97, 64, {'length': 1}),
    (98, 0, {'length': 42}),
    (98, 16, {'length': 28}),
    (98, 17, {'length': 22}),
    (98, 50, {'length': 43}),
    (98, 67, {'length': 13}),
    (98, 75, {'length': 41}),
    (98, 87, {'length': 7}),
    (98, 94, {'length': 11}),
    (99, 4, {'length': 28}),
    (99, 6, {'length': 27}),
    (99, 14, {'length': 17}),
    (99, 20, {'length': 32}),
    (99, 26, {'length': 30}),
    (99, 48, {'length': 46}),
    (99, 49, {'length': 2}),
    (99, 51, {'length': 23}),
    (99, 54, {'length': 34}),
    (99, 78, {'length': 13}),
    (99, 85, {'length': 38}),
    (99, 91, {'length': 40}),
]
